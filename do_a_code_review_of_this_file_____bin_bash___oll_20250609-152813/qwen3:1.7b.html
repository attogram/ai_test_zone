  <!DOCTYPE html>
  <html lang="en">
  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    a:hover { background-color: yellow; color: black; }
    body { font-family: monospace; }
    header, footer { background-color: #f0f0f0; padding: 10px; }
    li { margin: 5px; }
    table, td, th { border-collapse: collapse; }
    td, th { border: 1px solid #cccccc; padding: 5px; text-align: right; }
    tr:hover { background-color: lightyellow; color: black; }
    textarea { border: 1px solid #cccccc; white-space: pre-wrap; width: 90%; }
    .box { display: inline-block; margin: 3px; padding: 2px; vertical-align: top; }
    .left { text-align: left; }
    .menu { font-size: small; }
  </style>
<title>ollama-multirun: qwen3:1.7b</title></head><body>
<header><a href='../index.html'>ollama-multirun</a>: <a href='./index.html'>do_a_code_review_of_this_file_____bin_bash___oll</a>: <b>qwen3:1.7b</b>: 20250609-152813<br /><br />
<span class='menu'>
<a href='models.html'>models</a>: 
<a href='./qwen2.5-coder:7b.html'>qwen2.5-coder:7b</a> 
<a href='./codellama:7b.html'>codellama:7b</a> 
<a href='./starcoder:7b.html'>starcoder:7b</a> 
<a href='./stable-code:3b.html'>stable-code:3b</a> 
<a href='./deepcoder:1.5b.html'>deepcoder:1.5b</a> 
<a href='./dolphin3:8b.html'>dolphin3:8b</a> 
<a href='./gemma:2b.html'>gemma:2b</a> 
<a href='./granite3.3:2b.html'>granite3.3:2b</a> 
<a href='./mistral:7b.html'>mistral:7b</a> 
<b>qwen3:1.7b</b> 
</span>
</header>
<p>Prompt: (<a href='./prompt.txt'>raw</a>) (<a href='./do_a_code_review_of_this_file_____bin_bash___oll.prompt.yaml'>yaml</a>)
  words:2010  bytes:19270<br />
<textarea readonly rows='10'>Do a code review of this file: #!/bin/bash
#
# ollama-multirun
#
# Bash shell script to run a prompt against all models in ollama, and save the output as web pages
#
# Usage:
#  - Enter prompt manually:    ./multirun.sh
#  - Enter prompt as argument: ./multirun.sh &quot;your prompt&quot;
#  - Enter prompt from file:   ./multirun.sh &lt; prompt.txt
#  - Enter prompt from pipe:   echo &quot;your prompt&quot; | ./multirun.sh
#                              echo &quot;summarize this file: $(cat filename)&quot; | ./multirun.sh
#
#  - By default, will use all available models
#    To set a list of models to use, set as a comma-seperated list with -m
#      example:  ./multirun.sh -m deepseek-r1:1.5b,deepseek-r1:8b
#
# Requires: ollama, bash, expect, awk, basename, date, grep, mkdir, sed, sort, top, tr, uname, wc

NAME=&quot;ollama-multirun&quot;
VERSION=&quot;4.2&quot;
URL=&quot;https://github.com/attogram/ollama-multirun&quot;
RESULTS_DIRECTORY=&quot;results&quot;

echo; echo &quot;$NAME v$VERSION&quot;; echo

function parseCommandLine {
  modelsList=&quot;&quot;
  prompt=&quot;&quot;
  while (( &quot;$#&quot; )); do
    case &quot;$1&quot; in
      -m)
        if [ -n &quot;$2&quot; ] &amp;&amp; [ ${2:0:1} != &quot;-&quot; ]; then
          modelsList=$2
          shift 2
        else
          echo &quot;Error: Argument for $1 is missing&quot; &gt;&amp;2
          break
        fi
        ;;
      -*|--*=) # unsupported flags
        shift 2
        ;;
      *) # preserve positional arguments
        prompt=&quot;$prompt $1&quot;
        shift
        ;;
    esac
  done
  # set positional arguments in their proper place
  eval set -- &quot;$prompt&quot;
}

function setModels {
  models=($(ollama list | awk &#39;{if (NR &gt; 1) print $1}&#39; | sort)) # Get list of models, sorted alphabetically
  if [ -z &quot;$models&quot; ]; then
    echo &quot;No models found. Please install models with &#39;ollama pull &lt;model-name&gt;&#39;&quot;
    exit 1
  fi

  parsedModels=()
  if [ -n &quot;$modelsList&quot; ]; then
    IFS=&#39;,&#39; read -ra modelsListArray &lt;&lt;&lt; &quot;$modelsList&quot; # parse csv into modelsListArray
    for m in &quot;${modelsListArray[@]}&quot;; do
      if [[ &quot;${models[*]}&quot; =~ &quot;$m&quot; ]]; then # if model exists
        parsedModels+=(&quot;$m&quot;)
      else
        echo &quot;Error: model not found: $m&quot;
        exit
      fi
    done
  fi
  if [ -n &quot;$parsedModels&quot; ]; then
    models=(&quot;${parsedModels[@]}&quot;)
  fi

  echo &quot;models:&quot;;
  echo &quot;${models[@]}&quot;
  echo
}

function safeTag() {
  local input=&quot;$1&quot; # Get the input
  input=${input:0:50} # Truncate to first 50 characters
  input=$(echo &quot;$input&quot; | tr &#39;[:upper:]&#39; &#39;[:lower:]&#39;) # Convert to lowercase
  input=$(echo &quot;$input&quot; | sed &quot;s/ /_/g&quot;) # Replace spaces with underscores
  input=$(echo &quot;$input&quot; | sed &#39;s/[^a-zA-Z0-9_]/_/g&#39; | tr -cd &#39;a-zA-Z0-9_&#39;)
  echo &quot;$input&quot; # Output the sanitized string
}

function createResultsDirectory {
  tag=$(safeTag &quot;$prompt&quot;)
  tagDatetime=$(date &#39;+%Y%m%d-%H%M%S&#39;)
  directory=&quot;${RESULTS_DIRECTORY}/${tag}_${tagDatetime}&quot;
  echo; echo &quot;Creating: $directory/&quot;
  mkdir -p &quot;$directory&quot;
}

function setPrompt {
  if [ -n &quot;$prompt&quot; ]; then # if prompt is already set from command line
    return
  fi

  if [ -t 0 ]; then # Check if input is from a terminal (interactive)
    echo &quot;Enter prompt:&quot;;
    read -r prompt # Read prompt from user input
    return
  fi

  prompt=$(cat) # Read from standard input (pipe or file)
}

function savePrompt {
  echo; echo &quot;Prompt:&quot;; echo &quot;$prompt&quot;; echo

  promptFile=&quot;$directory/prompt.txt&quot;
  echo &quot;Creating: $promptFile&quot;
  echo &quot;$prompt&quot; &gt; &quot;$promptFile&quot;

  promptWords=$(wc -w &lt; &quot;$promptFile&quot; | awk &#39;{print $1}&#39;)
  promptBytes=$(wc -c &lt; &quot;$promptFile&quot; | awk &#39;{print $1}&#39;)

  # Github Prompt YAML: https://docs.github.com/en/github-models/use-github-models/storing-prompts-in-github-repositories
  promptYamlFile=&quot;$directory/$tag.prompt.yaml&quot;
  echo &quot;Creating: $promptYamlFile&quot;
  (
    echo &quot;messages:&quot;
    echo &quot;  - role: system&quot;
    echo &quot;    content: &#39;&#39;&quot;
    echo &quot;  - role: user&quot;
    echo &quot;    content: |&quot;
    while IFS= read -r line; do
      echo &quot;      $line&quot;
    done &lt;&lt;&lt; &quot;$prompt&quot;
    echo &quot;model: &#39;&#39;&quot;
  ) &gt; $promptYamlFile
}

function showPrompt {
  echo &quot;&lt;p&gt;Prompt: (&lt;a href=&#39;./prompt.txt&#39;&gt;raw&lt;/a&gt;) (&lt;a href=&#39;./${tag}.prompt.yaml&#39;&gt;yaml&lt;/a&gt;)&quot;
  echo &quot;  words:$promptWords  bytes:$promptBytes&lt;br /&gt;&quot;
  textarea &quot;$prompt&quot; 0 10 # 0 padding, max 10 lines
  echo &quot;&lt;/p&gt;&quot;
}

function showImages {
  if [ -n &quot;$addedImages&quot; ]; then
    for image in ${addedImages}; do
      echo -n &quot;&lt;div class=&#39;box&#39;&gt;&quot;
      echo -n &quot;&lt;a target=&#39;image&#39; href=&#39;$(basename $image)&#39;&gt;&lt;img src=&#39;$(basename $image)&#39; alt=&#39;$image&#39; width=&#39;250&#39; /&gt;&lt;/a&gt;&quot;
      echo -n &quot;&lt;/div&gt;&quot;
    done
    echo -n &quot;&lt;br /&gt;&quot;
  fi
}

function textarea() {
  local content=&quot;$1&quot; # Get the input
  if [ -z &quot;$content&quot; ]; then
    content=&quot;&quot;
  fi
  local padding=&quot;$2&quot;
  if [ -z &quot;$padding&quot; ]; then
    padding=0
  fi
  local max=&quot;$3&quot;
  if [ -z &quot;$max&quot; ]; then
    max=25
  fi
  local lines=$(echo &quot;$content
&quot; | wc -l) # Get number of lines in content
  lines=$((lines + padding))
  if [ &quot;$lines&quot; -gt &quot;$max&quot; ]; then
    lines=$max
  fi
  content=$(echo &quot;$content&quot; | sed &#39;s/&amp;/\&amp;amp;/g; s/&lt;/\&amp;lt;/g; s/&gt;/\&amp;gt;/g; s/&quot;/\&amp;quot;/g; s/&#39;&quot;&#39;&quot;&#39;/\&amp;#39;/g&#39;) # Escape HTML special characters
  echo &quot;&lt;textarea readonly rows=&#39;$lines&#39;&gt;${content}&lt;/textarea&gt;&quot;
}

function clearModel {
  echo &quot;Clearing: $1&quot;
  local expectedPrompt=&quot;&gt;&gt;&gt; &quot;
  local run=&quot;ollama run $1&quot;
  expect \
    -c &quot;spawn $run&quot; \
    -c &quot;expect \&quot;$expectedPrompt\&quot;&quot; \
    -c &#39;send -- &quot;/clear
&quot;&#39; \
    -c &quot;expect \&quot;$expectedPrompt\&quot;&quot; \
    -c &#39;send -- &quot;/bye
&quot;&#39; \
  ;
  echo &quot;Stopping: $1&quot;
  ollama stop &quot;$1&quot;
}

function showHeader {
  title=&quot;$1&quot;
  cat &lt;&lt; &quot;EOF&quot;
  &lt;!DOCTYPE html&gt;
  &lt;html lang=&quot;en&quot;&gt;
  &lt;head&gt;
  &lt;meta charset=&quot;UTF-8&quot;&gt;
  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
  &lt;style&gt;
    a:hover { background-color: yellow; color: black; }
    body { font-family: monospace; }
    header, footer { background-color: #f0f0f0; padding: 10px; }
    li { margin: 5px; }
    table, td, th { border-collapse: collapse; }
    td, th { border: 1px solid #cccccc; padding: 5px; text-align: right; }
    tr:hover { background-color: lightyellow; color: black; }
    textarea { border: 1px solid #cccccc; white-space: pre-wrap; width: 90%; }
    .box { display: inline-block; margin: 3px; padding: 2px; vertical-align: top; }
    .left { text-align: left; }
    .menu { font-size: small; }
  &lt;/style&gt;
EOF
  echo &quot;&lt;title&gt;$title&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&quot;
}

function showFooter {
  echo &quot;&lt;br /&gt;&lt;br /&gt;&quot;
  echo &quot;&lt;footer&gt;&quot;
  echo &quot;&lt;p&gt;page created:   $(date &#39;+%Y-%m-%d %H:%M:%S&#39;)&lt;/p&gt;&quot;
  echo &quot;&lt;p&gt;Generated with: &lt;a target=&#39;$NAME&#39; href=&#39;$URL&#39;&gt;$NAME&lt;/a&gt; v$VERSION&lt;/p&gt;&quot;
  echo &quot;&lt;/footer&gt;&lt;/body&gt;&lt;/html&gt;&quot;
}

function createMenu {
  local currentModel=&quot;$1&quot;
  echo &quot;&lt;span class=&#39;menu&#39;&gt;&quot;
  echo &quot;&lt;a href=&#39;models.html&#39;&gt;models&lt;/a&gt;: &quot;
  for modelName in ${models[@]}; do
    if [ &quot;$modelName&quot; == &quot;$currentModel&quot; ]; then
      echo &quot;&lt;b&gt;$modelName&lt;/b&gt; &quot;
    else
      echo &quot;&lt;a href=&#39;./$modelName.html&#39;&gt;$modelName&lt;/a&gt; &quot;
    fi
  done
  echo &#39;&lt;/span&gt;&#39;;
}

function setStats {
  statsTotalDuration=$(grep -oE &quot;total duration:[[:space:]]+(.*)&quot; &quot;$statsFile&quot; | awk &#39;{ print $NF }&#39;)
  statsLoadDuration=$(grep -oE &quot;load duration:[[:space:]]+(.*)&quot; &quot;$statsFile&quot; | awk &#39;{ print $NF }&#39;)
  statsPromptEvalCount=$(grep -oE &quot;prompt eval count:[[:space:]]+(.*)&quot; &quot;$statsFile&quot; | awk &#39;{ print $4, $5 }&#39;)
  statsPromptEvalDuration=$(grep -oE &quot;prompt eval duration:[[:space:]]+(.*)&quot; &quot;$statsFile&quot; | awk &#39;{ print $NF }&#39;)
  statsPromptEvalRate=$(grep -oE &quot;prompt eval rate:[[:space:]]+(.*)&quot; &quot;$statsFile&quot; | awk &#39;{ print $4, $5 }&#39;)
  statsEvalCount=$(grep -oE &quot;^eval count:[[:space:]]+(.*)&quot; &quot;$statsFile&quot; | awk &#39;{ print $3, $4 }&#39;)
  statsEvalDuration=$(grep -oE &quot;^eval duration:[[:space:]]+(.*)&quot; &quot;$statsFile&quot; | awk &#39;{ print $NF }&#39;)
  statsEvalRate=$(grep -oE &quot;^eval rate:[[:space:]]+(.*)&quot; &quot;$statsFile&quot; | awk &#39;{ print $3, $4 }&#39;)

  addedImages=$(grep -oE &quot;Added image &#39;(.*)&#39;&quot; &quot;$statsFile&quot; | awk &#39;{ print $NF }&#39; | sed &quot;s/&#39;//g&quot;)
  if [ -n &quot;$addedImages&quot; ]; then
    for image in ${addedImages}; do
      if ! [ -f &quot;$directory&quot;/&quot;$(basename $image)&quot; ]; then
        echo &quot;Copying image: $image&quot;
        cp $image $directory
      fi
    done
  fi

  responseWords=$(wc -w &lt; &quot;$modelFile&quot; | awk &#39;{print $1}&#39;)
  responseBytes=$(wc -c &lt; &quot;$modelFile&quot; | awk &#39;{print $1}&#39;)
}

function setOllamaStats {
  ollamaVersion=$(ollama -v | awk &#39;{print $4}&#39;)
  ollamaPs=$(ollama ps | awk &#39;{print $1, $2, $3, $4, $5, $6}&#39; | sed &#39;1d&#39;) # Get the first 6 columns of ollama ps output, skipping the header
  ollamaModel=$(echo &quot;$ollamaPs&quot; | awk &#39;{print $1}&#39;) # Get the model name
  ollamaProcessor=$(echo &quot;$ollamaPs&quot; | awk &#39;{print $5, $6}&#39;) # Get the processor
  ollamaSize=$(echo &quot;$ollamaPs&quot; | awk &#39;{print $3, $4}&#39;) # Get the model size
}

function setSystemStats {
  systemArch=$(uname -m) # Get hardware platform
  systemProcessor=$(uname -p) # Get system processor
  systemOSName=$(uname -s) # Get system OS name
  systemOSVersion=$(uname -r) # Get system OS version
  top=$(top -l 1)
  systemMemoryUsed=$(echo &quot;$top&quot; | awk &#39;/PhysMem/ {print $2}&#39;) # Get system memory used
  systemMemoryAvail=$(echo &quot;$top&quot; | awk &#39;/PhysMem/ {print $6}&#39;) # Get system memory available
}

function saveModelInfo { # Create model info files - for each model, do &#39;ollama show&#39; and save the results to text file
  for model in &quot;${models[@]}&quot;; do
    modelInfoFileFile=&quot;$directory/$model.info.txt&quot;
    echo &quot;Creating: $modelInfoFileFile&quot;
    ollama show &quot;$model&quot; &gt; &quot;$modelInfoFileFile&quot;
  done
}

function setModelInfo {
  modelInfoFile=&quot;$directory/$model.info.txt&quot;
  modelCapabilities=()
  modelSystemPrompt=&quot;&quot;
  modelTemperature=&quot;&quot;
  section=&quot;&quot;

  while IFS= read -r line; do # Read the content of the file line by line
    line=&quot;$(echo -e &quot;${line}&quot; | sed -e &#39;s/^[[:space:]]*//&#39; -e &#39;s/[[:space:]]*$//&#39;)&quot; # Trim leading/trailing whitespace
    if [[ -z &quot;$line&quot; ]]; then
      section=&quot;&quot;
      continue; # Skip empty lines
    fi
    if [[ $line == &quot;Model&quot;* ]]; then
      section=&quot;Model&quot;
      continue
    elif [[ $line == &quot;Capabilities&quot;* ]]; then
      section=&quot;Capabilities&quot;
      continue
    elif [[ $line == &quot;System&quot;* ]]; then
      section=&quot;System&quot;
      continue
    elif [[ $line == &quot;Parameters&quot;* ]]; then
      section=&quot;Parameters&quot;
      continue
    elif [[ $line == &quot;License&quot;* ]]; then
      section=&quot;License&quot;
      continue
    elif [[ $line == &quot;Projector&quot;* ]]; then
      section=&quot;Projector&quot;
      continue
    fi

    case $section in
      &quot;Model&quot;)
        if [[ &quot;$line&quot; == &quot;architecture&quot;* ]]; then
          modelArchitecture=$(echo &quot;$line&quot; | awk &#39;/architecture/ {print $2}&#39;) # Get model architecture
        fi
        if [[ &quot;$line&quot; == &quot;parameters&quot;* ]]; then
          modelParameters=$(echo &quot;$line&quot; | awk &#39;/parameters/ {print $2}&#39;) # Get model parameters
        fi
        if [[ &quot;$line&quot; == &quot;context length&quot;* ]]; then
          modelContextLength=$(echo &quot;$line&quot; | awk &#39;/context length/ {print $3}&#39;) # Get model context length
        fi
        if [[ &quot;$line&quot; == &quot;embedding length&quot;* ]]; then
          modelEmbeddingLength=$(echo &quot;$line&quot; | awk &#39;/embedding length/ {print $3}&#39;) # Get model embedding length
        fi
        if [[ &quot;$line&quot; == &quot;quantization&quot;* ]]; then
          modelQuantization=$(echo &quot;$line&quot; | awk &#39;/quantization/ {print $2}&#39;) # Get model quantization
        fi
        ;;
      &quot;Capabilities&quot;)
        modelCapabilities+=(&quot;$line&quot;)
        ;;
      &quot;System&quot;)
        modelSystemPrompt+=&quot;$line&quot;$&#39;
&#39;
        ;;
      &quot;Parameters&quot;)
        if [[ &quot;$line&quot; == &quot;temperature&quot;* ]]; then
          modelTemperature=$(echo &quot;$line&quot; | awk &#39;/temperature/ {print $2}&#39;) # Get model temperature
        fi
        ;;
    esac
  done &lt; &quot;$modelInfoFile&quot;
}

function createModelsIndexFile {
  modelsIndexFile=&quot;$directory/models.html&quot;
  echo &quot;Creating: $modelsIndexFile&quot;
  {
    showHeader &quot;$NAME: models&quot;
    echo &quot;&lt;header&gt;&lt;a href=&#39;../index.html&#39;&gt;$NAME&lt;/a&gt;: &lt;a href=&#39;./index.html&#39;&gt;$tag&lt;/a&gt;: &lt;b&gt;models&lt;/b&gt;: $tagDatetime&lt;/header&gt;&quot;
    cat &lt;&lt;- &quot;EOF&quot;
&lt;br /&gt;
&lt;table&gt;
  &lt;tr&gt;
    &lt;th class=&#39;left&#39;&gt;model&lt;/th&gt;
    &lt;th&gt;architecture&lt;/th&gt;
    &lt;th&gt;parameters&lt;/th&gt;
    &lt;th&gt;context&lt;br /&gt;length&lt;/th&gt;
    &lt;th&gt;embedding&lt;br /&gt;length&lt;/th&gt;
    &lt;th&gt;quantization&lt;/th&gt;
    &lt;th&gt;temperature&lt;/th&gt;
    &lt;th&gt;capabilities&lt;/th&gt;
    &lt;th class=&#39;left&#39;&gt;system prompt&lt;/th&gt;
    &lt;th&gt;(raw)&lt;/th&gt;
  &lt;/tr&gt;
EOF
  } &gt; &quot;$modelsIndexFile&quot;

  for model in &quot;${models[@]}&quot;; do
    setModelInfo
    {
      echo &quot;&lt;tr&gt;&quot;
      echo &quot;&lt;td class=&#39;left&#39;&gt;&lt;a href=&#39;./$model.html&#39;&gt;$model&lt;/a&gt;&lt;/td&gt;&quot;
      echo &quot;&lt;td&gt;$modelArchitecture&lt;/td&gt;&quot;
      echo &quot;&lt;td&gt;$modelParameters&lt;/td&gt;&quot;
      echo &quot;&lt;td&gt;$modelContextLength&lt;/td&gt;&quot;
      echo &quot;&lt;td&gt;$modelEmbeddingLength&lt;/td&gt;&quot;
      echo &quot;&lt;td&gt;$modelQuantization&lt;/td&gt;&quot;
      echo &quot;&lt;td&gt;$modelTemperature&lt;/td&gt;&quot;
      echo &quot;&lt;td class=&#39;left&#39;&gt;$(printf &quot;%s&lt;br /&gt;&quot; &quot;${modelCapabilities[@]}&quot;)&lt;/td&gt;&quot;
      echo &quot;&lt;td class=&#39;left&#39;&gt;$modelSystemPrompt&lt;/td&gt;&quot;
      echo &quot;&lt;td&gt;&lt;a href=&#39;./$model.info.txt&#39;&gt;raw&lt;/a&gt;&lt;/td&gt;&quot;
      echo &quot;&lt;/tr&gt;&quot;
    } &gt;&gt; &quot;$modelsIndexFile&quot;
  done

  {
    echo &quot;&lt;/table&gt;&quot;
    showFooter
  } &gt;&gt; &quot;$modelsIndexFile&quot;
}

function createModelFile {
  modelHtmlFile=&quot;$directory/$model.html&quot;
  echo &quot;Creating: $modelHtmlFile&quot;
  {
    showHeader &quot;$NAME: $model&quot;
    echo &quot;&lt;header&gt;&lt;a href=&#39;../index.html&#39;&gt;$NAME&lt;/a&gt;: &lt;a href=&#39;./index.html&#39;&gt;$tag&lt;/a&gt;: &lt;b&gt;$model&lt;/b&gt;: $tagDatetime&lt;br /&gt;&lt;br /&gt;&quot;
    createMenu &quot;$model&quot;
    echo &quot;&lt;/header&gt;&quot;
    showPrompt
    showImages
    echo &quot;&lt;p&gt;Output: $model (&lt;a href=&#39;./$model.txt&#39;&gt;raw&lt;/a&gt;)&lt;br /&gt;&quot;
    textarea &quot;$(cat &quot;$modelFile&quot;)&quot; 3 25 # 5 padding, max 30 lines
    echo &quot;&lt;/p&gt;&quot;

    echo &quot;&lt;div class=&#39;box&#39;&gt;&lt;table&gt;&quot;
    echo &quot;&lt;tr&gt;&lt;td class=&#39;left&#39; colspan=&#39;2&#39;&gt;Stats (&lt;a href=&#39;./$model.stats.txt&#39;&gt;raw&lt;/a&gt;)&lt;/td&gt;&lt;/tr&gt;&quot;
    echo &quot;&lt;tr&gt;&lt;td class=&#39;left&#39;&gt;words&lt;/td&gt;&lt;td&gt;$responseWords&lt;/td&gt;&lt;/tr&gt;&quot;
    echo &quot;&lt;tr&gt;&lt;td class=&#39;left&#39;&gt;bytes&lt;/td&gt;&lt;td&gt;$responseBytes&lt;/td&gt;&lt;/tr&gt;&quot;
    echo &quot;&lt;tr&gt;&lt;td class=&#39;left&#39;&gt;total duration&lt;/td&gt;&lt;td&gt;$statsTotalDuration&lt;/td&gt;&lt;/tr&gt;&quot;
    echo &quot;&lt;tr&gt;&lt;td class=&#39;left&#39;&gt;load duration&lt;/td&gt;&lt;td&gt;$statsLoadDuration&lt;/td&gt;&lt;/tr&gt;&quot;
    echo &quot;&lt;tr&gt;&lt;td class=&#39;left&#39;&gt;prompt eval count&lt;/td&gt;&lt;td&gt;$statsPromptEvalCount&lt;/td&gt;&lt;/tr&gt;&quot;
    echo &quot;&lt;tr&gt;&lt;td class=&#39;left&#39;&gt;prompt eval duration&lt;/td&gt;&lt;td&gt;$statsPromptEvalDuration&lt;/td&gt;&lt;/tr&gt;&quot;
    echo &quot;&lt;tr&gt;&lt;td class=&#39;left&#39;&gt;prompt eval rate&lt;/td&gt;&lt;td&gt;$statsPromptEvalRate&lt;/td&gt;&lt;/tr&gt;&quot;
    echo &quot;&lt;tr&gt;&lt;td class=&#39;left&#39;&gt;eval count&lt;/td&gt;&lt;td&gt;$statsEvalCount&lt;/td&gt;&lt;/tr&gt;&quot;
    echo &quot;&lt;tr&gt;&lt;td class=&#39;left&#39;&gt;eval duration&lt;/td&gt;&lt;td&gt;$statsEvalDuration&lt;/td&gt;&lt;/tr&gt;&quot;
    echo &quot;&lt;tr&gt;&lt;td class=&#39;left&#39;&gt;eval rate&lt;/td&gt;&lt;td&gt;$statsEvalRate&lt;/td&gt;&lt;/tr&gt;&quot;
    echo &quot;&lt;/table&gt;&lt;/div&gt;&quot;

    echo &quot;&lt;div class=&#39;box&#39;&gt;&lt;table&gt;&quot;
    echo &quot;&lt;tr&gt;&lt;td class=&#39;left&#39; colspan=&#39;2&#39;&gt;Model (&lt;a href=&#39;./$model.info.txt&#39;&gt;raw&lt;/a&gt;)&lt;/td&gt;&lt;/tr&gt;&quot;
    echo &quot;&lt;tr&gt;&lt;td class=&#39;left&#39;&gt;name&lt;/td&gt;&lt;td class=&#39;left&#39;&gt;&lt;a target=&#39;ollama&#39; href=&#39;https://ollama.com/library/${model}&#39;&gt;$model&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;&quot;
    echo &quot;&lt;tr&gt;&lt;td class=&#39;left&#39;&gt;architecture&lt;/td&gt;&lt;td class=&#39;left&#39;&gt;$modelArchitecture&lt;/td&gt;&lt;/tr&gt;&quot;
    echo &quot;&lt;tr&gt;&lt;td class=&#39;left&#39;&gt;size&lt;/td&gt;&lt;td class=&#39;left&#39;&gt;$ollamaSize&lt;/td&gt;&lt;/tr&gt;&quot;
    echo &quot;&lt;tr&gt;&lt;td class=&#39;left&#39;&gt;parameters&lt;/td&gt;&lt;td class=&#39;left&#39;&gt;$modelParameters&lt;/td&gt;&lt;/tr&gt;&quot;
    echo &quot;&lt;tr&gt;&lt;td class=&#39;left&#39;&gt;context length&lt;/td&gt;&lt;td class=&#39;left&#39;&gt;$modelContextLength&lt;/td&gt;&lt;/tr&gt;&quot;
    echo &quot;&lt;tr&gt;&lt;td class=&#39;left&#39;&gt;embedding length&lt;/td&gt;&lt;td  class=&#39;left&#39;&gt;$modelEmbeddingLength&lt;/td&gt;&lt;/tr&gt;&quot;
    echo &quot;&lt;tr&gt;&lt;td class=&#39;left&#39;&gt;quantization&lt;/td&gt;&lt;td class=&#39;left&#39;&gt;$modelQuantization&lt;/td&gt;&lt;/tr&gt;&quot;
    echo &quot;&lt;tr&gt;&lt;td class=&#39;left&#39;&gt;capabilities&lt;/td&gt;&lt;td class=&#39;left&#39;&gt;$(printf &quot;%s&lt;br /&gt;&quot; &quot;${modelCapabilities[@]}&quot;)&lt;/td&gt;&quot;
    echo &quot;&lt;/table&gt;&lt;/div&gt;&quot;

    echo &quot;&lt;div class=&#39;box&#39;&gt;&lt;table&gt;&quot;
    echo &quot;&lt;tr&gt;&lt;td class=&#39;left&#39; colspan=&#39;2&#39;&gt;System&lt;/td&gt;&lt;/tr&gt;&quot;
    echo &quot;&lt;tr&gt;&lt;td class=&#39;left&#39;&gt;ollama proc&lt;/td&gt;&lt;td class=&#39;left&#39;&gt;$ollamaProcessor&lt;/td&gt;&lt;/tr&gt;&quot;
    echo &quot;&lt;tr&gt;&lt;td class=&#39;left&#39;&gt;ollama version&lt;/td&gt;&lt;td class=&#39;left&#39;&gt;$ollamaVersion&lt;/td&gt;&lt;/tr&gt;&quot;
    echo &quot;&lt;tr&gt;&lt;td class=&#39;left&#39;&gt;sys arch&lt;/td&gt;&lt;td class=&#39;left&#39;&gt;$systemArch&lt;/td&gt;&lt;/tr&gt;&quot;
    echo &quot;&lt;tr&gt;&lt;td class=&#39;left&#39;&gt;sys processor&lt;/td&gt;&lt;td class=&#39;left&#39;&gt;$systemProcessor&lt;/td&gt;&lt;/tr&gt;&quot;
    echo &quot;&lt;tr&gt;&lt;td class=&#39;left&#39;&gt;sys memory&lt;/td&gt;&lt;td class=&#39;left&#39;&gt;$systemMemoryUsed + $systemMemoryAvail&lt;/td&gt;&lt;/tr&gt;&quot;
    echo &quot;&lt;tr&gt;&lt;td class=&#39;left&#39;&gt;sys OS&lt;/td&gt;&lt;td class=&#39;left&#39;&gt;$systemOSName $systemOSVersion&lt;/td&gt;&lt;/tr&gt;&quot;
    echo &quot;&lt;/table&gt;&lt;/div&gt;&quot;

    showFooter
  } &gt; &quot;$modelHtmlFile&quot;
}

function createResultsIndexFile {
  resultsIndexFile=&quot;${RESULTS_DIRECTORY}/index.html&quot;
  echo &quot;Creating: $resultsIndexFile&quot;
  {
    showHeader &quot;$NAME: results&quot;
    echo &quot;&lt;header&gt;&lt;p&gt;&lt;b&gt;$NAME&lt;/b&gt;&lt;/p&gt;&lt;/header&gt;&quot;
    echo &quot;&lt;ul&gt;&quot;
    for dir in &quot;$RESULTS_DIRECTORY&quot;/*; do
      if [ -d &quot;$dir&quot; ]; then
        echo &quot;&lt;li&gt;&lt;a href=&#39;${dir##*/}/index.html&#39;&gt;${dir##*/}&lt;/a&gt;&lt;/li&gt;&quot;
      fi
    done
    echo &quot;&lt;/ul&gt;&quot;
    showFooter
  } &gt; $resultsIndexFile
}

function createIndexFile {
  indexFile=&quot;$directory/index.html&quot;
  echo &quot;Creating: $indexFile&quot;
  {
    showHeader &quot;$NAME: $tag&quot;
    echo &quot;&lt;header&gt;&lt;a href=&#39;../index.html&#39;&gt;$NAME&lt;/a&gt;: &lt;b&gt;$tag&lt;/b&gt;: $tagDatetime&lt;br /&gt;&lt;br /&gt;&quot;
    createMenu &quot;index&quot;
    echo  &quot;&lt;/header&gt;&quot;
    showPrompt
    echo &quot;&lt;!-- IMAGES --&gt;&quot;
    cat &lt;&lt;- &quot;EOF&quot;
&lt;table&gt;
  &lt;tr&gt;
    &lt;th class=&#39;left&#39;&gt;model&lt;/th&gt;
    &lt;th&gt;words&lt;/th&gt;
    &lt;th&gt;bytes&lt;/th&gt;
    &lt;th&gt;total&lt;br /&gt;duration&lt;/th&gt;
    &lt;th&gt;load&lt;br /&gt;duration&lt;/th&gt;
    &lt;th&gt;prompt eval&lt;br /&gt;count&lt;/th&gt;
    &lt;th&gt;prompt eval&lt;br /&gt;duration&lt;/th&gt;
    &lt;th&gt;prompt eval&lt;br /&gt;rate&lt;/th&gt;
    &lt;th&gt;eval&lt;br /&gt;count&lt;/th&gt;
    &lt;th&gt;eval&lt;br /&gt;duration&lt;/th&gt;
    &lt;th&gt;eval&lt;br /&gt;rate&lt;/th&gt;
  &lt;/tr&gt;
EOF
  } &gt; &quot;$indexFile&quot;
}

function addModelToIndexFile {
  (
    echo &quot;&lt;tr&gt;&quot;
    echo &quot;&lt;td class=&#39;left&#39;&gt;&lt;a href=&#39;./$model.html&#39;&gt;$model&lt;/a&gt;&lt;/td&gt;&quot;
    echo &quot;&lt;td&gt;$responseWords&lt;/td&gt;&quot;
    echo &quot;&lt;td&gt;$responseBytes&lt;/td&gt;&quot;
    echo &quot;&lt;td&gt;$statsTotalDuration&lt;/td&gt;&quot;
    echo &quot;&lt;td&gt;$statsLoadDuration&lt;/td&gt;&quot;
    echo &quot;&lt;td&gt;$statsPromptEvalCount&lt;/td&gt;&quot;
    echo &quot;&lt;td&gt;$statsPromptEvalDuration&lt;/td&gt;&quot;
    echo &quot;&lt;td&gt;$statsPromptEvalRate&lt;/td&gt;&quot;
    echo &quot;&lt;td&gt;$statsEvalCount&lt;/td&gt;&quot;
    echo &quot;&lt;td&gt;$statsEvalDuration&lt;/td&gt;&quot;
    echo &quot;&lt;td&gt;$statsEvalRate&lt;/td&gt;&quot;
    echo &quot;&lt;/tr&gt;&quot;
  ) &gt;&gt; &quot;$indexFile&quot;
}

function finishIndexFile {
  {
    echo &quot;&lt;/table&gt;&quot;
    echo &quot;&lt;br /&gt;&lt;br /&gt;&quot;
    echo &quot;&lt;table&gt;&quot;
    echo &quot;&lt;tr&gt;&lt;td class=&#39;left&#39; colspan=&#39;2&#39;&gt;System&lt;/td&gt;&lt;/tr&gt;&quot;
    echo &quot;&lt;tr&gt;&lt;td class=&#39;left&#39;&gt;ollama proc&lt;/td&gt;&lt;td&gt;$ollamaProcessor&lt;/td&gt;&lt;/tr&gt;&quot;
    echo &quot;&lt;tr&gt;&lt;td class=&#39;left&#39;&gt;ollama version&lt;/td&gt;&lt;td&gt;$ollamaVersion&lt;/td&gt;&lt;/tr&gt;&quot;
    echo &quot;&lt;tr&gt;&lt;td class=&#39;left&#39;&gt;sys arch&lt;/td&gt;&lt;td&gt;$systemArch&lt;/td&gt;&lt;/tr&gt;&quot;
    echo &quot;&lt;tr&gt;&lt;td class=&#39;left&#39;&gt;sys processor&lt;/td&gt;&lt;td&gt;$systemProcessor&lt;/td&gt;&lt;/tr&gt;&quot;
    echo &quot;&lt;tr&gt;&lt;td class=&#39;left&#39;&gt;sys memory&lt;/td&gt;&lt;td&gt;$systemMemoryUsed + $systemMemoryAvail&lt;/td&gt;&lt;/tr&gt;&quot;
    echo &quot;&lt;tr&gt;&lt;td class=&#39;left&#39;&gt;sys OS&lt;/td&gt;&lt;td&gt;$systemOSName $systemOSVersion&lt;/td&gt;&lt;/tr&gt;&quot;
    echo &quot;&lt;/table&gt;&quot;
    showFooter
  } &gt;&gt; &quot;$indexFile&quot;

  imagesHtml=$(showImages)
  sed -i -e &quot;s#&lt;!-- IMAGES --&gt;#${imagesHtml}#&quot; $indexFile
}

export OLLAMA_MAX_LOADED_MODELS=1
export OLLAMA_KEEP_ALIVE=0 # or: run --keepalive 0

parseCommandLine &quot;$@&quot;
setModels
setPrompt
createResultsDirectory
savePrompt
setSystemStats
createResultsIndexFile
createIndexFile
saveModelInfo
createModelsIndexFile

for model in &quot;${models[@]}&quot;; do # Loop through each model and run it with the given prompt
  echo; echo &quot;Running model: $model&quot;
  modelFile=&quot;$directory/$model.txt&quot;
  statsFile=&quot;$directory/$model.stats.txt&quot;
  echo &quot;Creating: $modelFile&quot;
  echo &quot;Creating: $statsFile&quot;
  ollama run --verbose &quot;$model&quot; -- &quot;${prompt}&quot; &gt; &quot;$modelFile&quot; 2&gt; &quot;$statsFile&quot;
  setModelInfo
  setOllamaStats
  setStats
  createModelFile
  addModelToIndexFile
  clearModel &quot;$model&quot;
done

finishIndexFile

echo; echo &quot;Done: $directory/&quot;</textarea>
</p>
<p>Output: qwen3:1.7b (<a href='./qwen3:1.7b.txt'>raw</a>)<br />
<textarea readonly rows='25'>Thinking...
Okay, let&#39;s try to figure out what&#39;s going on here. The user provided a script that seems to be related to running models, maybe with Ollama, and generating HTML files. The script has a lot of functions and variables, but I need to parse through it to understand the steps.

First, the script starts by setting up some export variables, like OLLAMA_MAX_LOADED_MODELS and OLLAMA_KEEP_ALIVE. These might control how many models are loaded and whether the script keeps running after the models are processed. Then there&#39;s a parseCommandLine function that takes command-line arguments, which I guess are the model names and prompt.

The script then sets up models, prompt, results directory, saves the prompt, sets system stats, creates the results index file, creates the index file, saves model info, and creates the models index file. After that, it loops through each model, runs it with the given prompt, and processes the output.

The key parts are the functions like createModelFile, addModelToIndexFile, and finishIndexFile. Each of these handles generating the HTML for a specific model. The script also includes commands like showHeader, showPrompt, showImages, and others to generate the HTML content.

The user might be trying to create a web interface for running different models with a specific prompt and displaying the results in HTML. The script seems to be generating multiple HTML files for each model, including the index file with all the models&#39; data.

I need to check if there are any potential issues. For example, the script uses OLLAMA_RUN with --verbose, which might be necessary for getting detailed output. Also, the variables like systemArch, systemProcessor, etc., are set during the system stats setup. The script also handles images by calling showImages, which might be a function that generates the HTML for images.

Wait, the user&#39;s code has a function called showImages, but in the provided code, it&#39;s not defined. That&#39;s a problem. The code might have a typo or missing function definitions. Also, the script uses functions like showHeader, showPrompt, etc., which are probably placeholders or part of the script&#39;s logic.

Another thing to note is that the script loops through each model, runs it with the prompt, and then adds the model&#39;s data to the index file. The finishIndexFile function appends the system stats and images to the index file.

So, the main steps are:

1. Set up environment variables.
2. Parse command-line arguments.
3. Prepare directories and files.
4. Generate index and models index files.
5. Run each model with the prompt and collect data.
6. Output the results in HTML.

Potential issues could be:

- The showImages function is not defined, which might cause errors.
- The script might not handle all edge cases, like when models aren&#39;t found or when there&#39;s an error running Ollama.
- The system stats are set during the script&#39;s execution, but if the script is run in a different environment, those variables might not be correctly set.

The user might be trying to create a web interface for their models, displaying the results in HTML. The script is pretty comprehensive, but there are some missing functions and possible errors.
...done thinking.

The script provided is a comprehensive tool for generating HTML files to showcase the results of running multiple models with a specific prompt, using the Ollama framework. It includes functions for setting up the environment, generating HTML content, and processing model outputs. Here&#39;s a breakdown of its key components and potential issues:

---

### **Key Features**
1. **Environment Setup**:
   - Sets environment variables for model limits and keep-alive behavior.
   - Parses command-line arguments for model names and prompt.

2. **File Management**:
   - Creates directories (`results`) and files (`index.html`, `model.html`, `stats.txt`) for storing outputs.
   - Saves prompt and model information for later use.

3. **HTML Generation**:
   - **Index File**: Lists all models with their statistics and system information.
   - **Model Files**: Each model&#39;s output is generated with detailed statistics, model specs, and system data.
   - **Images**: Displays model outputs in a table with metadata (words, bytes, durations, etc.).

4. **Model Execution**:
   - Runs each model with the given prompt using `ollama run --verbose`.
   - Collects statistics (e.g., prompt evaluations, durations) and updates the index file.

5. **System Information**:
   - Retrieves system details (architecture, memory, OS) and displays them in the index file.

---

### **Potential Issues**
1. **Missing Function Definitions**:
   - `showImages`, `showHeader`, `showPrompt`, etc., are not defined in the provided code. These functions likely handle HTML generation logic (e.g., inserting tables, formatting text).

2. **Environment Variables**:
   - The script assumes `OLLAMA_MAX_LOADED_MODELS` and `OLLAMA_KEEP_ALIVE` are set. If not, it might fail with errors related to model limits or keep-alive behavior.

3. **System Stats**:
   - The script retrieves system stats (e.g., `systemArch`, `systemMemoryUsed`) during runtime. If the script is run in an environment without these variables, the output will be incorrect.

4. **Image Handling**:
   - The `showImages` function is not defined, which could cause errors when generating HTML for model outputs. The script might not display images or metadata correctly.

5. **Error Handling**:
   - The script lacks robust error handling for cases like:
     - Missing models.
     - Failed `ollama run` commands.
     - Incorrect file paths or permissions.

---

### **Usage Example**
To run the script with a specific model and prompt:
```bash
python script.py --model my_model --prompt &quot;Your prompt here&quot;
```
This would generate:
- `my_model.html` with the model&#39;s output and statistics.
- `my_model.stats.txt` with detailed runtime data.
- An `index.html` listing all models and their results.

---

### **Recommendations**
1. **Define Missing Functions**:
   - Implement `showImages`, `showHeader`, `showPrompt`, etc., to handle HTML generation logic.

2. **Validate Environment Variables**:
   - Ensure `OLLAMA_MAX_LOADED_MODELS` and `OLLAMA_KEEP_ALIVE` are set appropriately for your use case.

3. **Add Error Handling**:
   - Handle cases where models are not found, `ollama run` fails, or files cannot be written.

4. **Test in a Controlled Environment**:
   - Run the script in a local setup with valid models and prompts to ensure all functions work as expected.

---

### **Conclusion**
The script is a well-structured tool for generating HTML results from Ollama models. However, it relies on missing functions and assumes certain environment variables. To use it effectively, ensure all dependencies (functions, variables) are properly defined and the script is tested in a valid environment.</textarea>
</p>
<div class='box'><table>
<tr><td class='left' colspan='2'>Stats (<a href='./qwen3:1.7b.stats.txt'>raw</a>)</td></tr>
<tr><td class='left'>words</td><td>1035</td></tr>
<tr><td class='left'>bytes</td><td>6881</td></tr>
<tr><td class='left'>total duration</td><td>53.259561834s</td></tr>
<tr><td class='left'>load duration</td><td>1.442853167s</td></tr>
<tr><td class='left'>prompt eval count</td><td>4096 token(s)</td></tr>
<tr><td class='left'>prompt eval duration</td><td>7.570412416s</td></tr>
<tr><td class='left'>prompt eval rate</td><td>541.05 tokens/s</td></tr>
<tr><td class='left'>eval count</td><td>1460 token(s)</td></tr>
<tr><td class='left'>eval duration</td><td>44.24352775s</td></tr>
<tr><td class='left'>eval rate</td><td>33.00 tokens/s</td></tr>
</table></div>
<div class='box'><table>
<tr><td class='left' colspan='2'>Model (<a href='./qwen3:1.7b.info.txt'>raw</a>)</td></tr>
<tr><td class='left'>name</td><td class='left'><a target='ollama' href='https://ollama.com/library/qwen3:1.7b'>qwen3:1.7b</a></td></tr>
<tr><td class='left'>architecture</td><td class='left'>qwen3</td></tr>
<tr><td class='left'>size</td><td class='left'>3.0 GB</td></tr>
<tr><td class='left'>parameters</td><td class='left'>2.0B</td></tr>
<tr><td class='left'>context length</td><td class='left'>40960</td></tr>
<tr><td class='left'>embedding length</td><td  class='left'>2048</td></tr>
<tr><td class='left'>quantization</td><td class='left'>Q4_K_M</td></tr>
<tr><td class='left'>capabilities</td><td class='left'>completion<br />tools<br />thinking<br /></td>
</table></div>
<div class='box'><table>
<tr><td class='left' colspan='2'>System</td></tr>
<tr><td class='left'>ollama proc</td><td class='left'>100% GPU</td></tr>
<tr><td class='left'>ollama version</td><td class='left'>0.9.0</td></tr>
<tr><td class='left'>sys arch</td><td class='left'>arm64</td></tr>
<tr><td class='left'>sys processor</td><td class='left'>arm</td></tr>
<tr><td class='left'>sys memory</td><td class='left'>11G + 1885M</td></tr>
<tr><td class='left'>sys OS</td><td class='left'>Darwin 24.5.0</td></tr>
</table></div>
<br /><br />
<footer>
<p>page created:   2025-06-09 15:37:11</p>
<p>Generated with: <a target='ollama-multirun' href='https://github.com/attogram/ollama-multirun'>ollama-multirun</a> v4.2</p>
</footer></body></html>
